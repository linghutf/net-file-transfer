00000000: 7061 636b 6167 6520 6d61 696e 0a0a 696d  package main..im
00000010: 706f 7274 2028 0a09 2266 6c61 6722 0a09  port (.."flag"..
00000020: 226e 6574 220a 0a09 222e 2f66 696c 6564  "net"..."./filed
00000030: 6174 6122 0a09 222e 2f75 7469 6c22 0a29  ata".."./util".)
00000040: 0a0a 7661 7220 280a 0968 6f73 7420 3d20  ..var (..host = 
00000050: 666c 6167 2e53 7472 696e 6728 2268 222c  flag.String("h",
00000060: 2022 6c6f 6361 6c68 6f73 7422 2c20 2268   "localhost", "h
00000070: 6f73 7420 6970 2229 0a09 706f 7274 203d  ost ip")..port =
00000080: 2066 6c61 672e 5374 7269 6e67 2822 7022   flag.String("p"
00000090: 2c20 7574 696c 2e50 4f52 542c 2022 706f  , util.PORT, "po
000000a0: 7274 2229 0a0a 0966 696c 656e 616d 6520  rt")...filename 
000000b0: 3d20 666c 6167 2e53 7472 696e 6728 2266  = flag.String("f
000000c0: 222c 2022 222c 2022 6669 6c65 2229 0a29  ", "", "file").)
000000d0: 0a0a 6675 6e63 206d 6169 6e28 2920 7b0a  ..func main() {.
000000e0: 0966 6c61 672e 5061 7273 6528 290a 0963  .flag.Parse()..c
000000f0: 6f6e 6e2c 2065 7272 203a 3d20 6e65 742e  onn, err := net.
00000100: 4469 616c 2822 7463 7034 222c 202a 686f  Dial("tcp4", *ho
00000110: 7374 2b22 3a22 2b2a 706f 7274 290a 0975  st+":"+*port)..u
00000120: 7469 6c2e 4368 6563 6b45 7272 2865 7272  til.CheckErr(err
00000130: 290a 0964 6566 6572 2063 6f6e 6e2e 436c  )..defer conn.Cl
00000140: 6f73 6528 290a 0a09 5365 6e64 4669 6c65  ose()...SendFile
00000150: 2863 6f6e 6e2c 2066 696c 656e 616d 6529  (conn, filename)
00000160: 0a0a 7d0a 0a66 756e 6320 5365 6e64 4669  ..}..func SendFi
00000170: 6c65 2863 6f6e 6e20 6e65 742e 436f 6e6e  le(conn net.Conn
00000180: 2c20 6669 6c65 6e61 6d65 202a 7374 7269  , filename *stri
00000190: 6e67 2920 7b0a 0966 696e 666f 2c20 6461  ng) {..finfo, da
000001a0: 7461 203a 3d20 7574 696c 2e52 6561 6446  ta := util.ReadF
000001b0: 696c 6528 2a66 696c 656e 616d 6529 0a09  ile(*filename)..
000001c0: 6669 6e66 6f2e 4361 6c63 4368 6563 6b49  finfo.CalcCheckI
000001d0: 6e66 6f28 6461 7461 290a 092f 2fe5 ba8f  nfo(data)..//...
000001e0: e588 97e5 8c96 e696 87e4 bbb6 e4bf a1e6  ................
000001f0: 81af 0a09 6275 6620 3a3d 2066 696c 6564  ....buf := filed
00000200: 6174 612e 5772 6974 6546 696c 6549 6e66  ata.WriteFileInf
00000210: 6f28 6669 6e66 6f29 0a09 5f2c 2065 7272  o(finfo).._, err
00000220: 203a 3d20 636f 6e6e 2e57 7269 7465 2862   := conn.Write(b
00000230: 7566 290a 0975 7469 6c2e 4368 6563 6b45  uf)..util.CheckE
00000240: 7272 2865 7272 290a 0a09 2f2a e696 b9e6  rr(err).../*....
00000250: a188 310a 0974 6d70 203a 3d20 6d61 6b65  ..1..tmp := make
00000260: 285b 5d62 7974 652c 2032 3536 290a 0962  ([]byte, 256)..b
00000270: 7974 6563 6f75 6e74 203a 3d20 300a 0963  ytecount := 0..c
00000280: 6f70 7928 746d 702c 2064 6174 6129 0a09  opy(tmp, data)..
00000290: 666f 7220 7b0a 0909 6e2c 2065 7272 203a  for {...n, err :
000002a0: 3d20 636f 6e6e 2e57 7269 7465 2874 6d70  = conn.Write(tmp
000002b0: 290a 0909 7574 696c 2e43 6865 636b 4572  )...util.CheckEr
000002c0: 7228 6572 7229 0a09 0962 7974 6563 6f75  r(err)...bytecou
000002d0: 6e74 202b 3d20 6e0a 0909 6966 2062 7974  nt += n...if byt
000002e0: 6563 6f75 6e74 203d 3d20 6669 6e66 6f2e  ecount == finfo.
000002f0: 5369 7a65 207b 0a09 0909 6272 6561 6b0a  Size {....break.
00000300: 0909 7d0a 0a09 0963 6f70 7928 746d 702c  ..}....copy(tmp,
00000310: 2064 6174 615b 6279 7465 636f 756e 743a   data[bytecount:
00000320: 5d29 0a09 7d0a 092a 2f0a 092f 2ae6 96b9  ])..}..*/../*...
00000330: e6a1 8832 0a09 6e2c 2065 7272 203a 3d20  ...2..n, err := 
00000340: 636f 6e6e 2e57 7269 7465 2864 6174 6129  conn.Write(data)
00000350: 0a09 7574 696c 2e43 6865 636b 4572 7228  ..util.CheckErr(
00000360: 6572 7229 0a09 6966 206e 203d 3d20 3020  err)..if n == 0 
00000370: 7b0a 0909 646f 6e65 203c 2d20 320a 097d  {...done <- 2..}
00000380: 0a09 2a2f 0a09 7574 696c 2e53 656e 6444  ..*/..util.SendD
00000390: 6174 6128 636f 6e6e 2c20 6461 7461 290a  ata(conn, data).
000003a0: 0a7d 0a                                  .}.
